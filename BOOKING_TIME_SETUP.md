# 予約受付時間設定のセットアップガイド

## 🔧 問題: "予約受付時間設定エラー" が表示される

このエラーは、Supabaseデータベースに `booking_time_schedules` テーブルが正しく設定されていない場合に発生します。

---

## ✅ 解決方法

### ステップ1: Supabaseにログイン

1. [Supabase Dashboard](https://app.supabase.com) にアクセス
2. プロジェクトを選択

### ステップ2: SQL Editorを開く

1. 左サイドバーの **「SQL Editor」** をクリック
2. **「New query」** をクリック

### ステップ3: SQLを実行

以下のいずれかのSQLファイルの内容をコピーして実行：

#### オプション1: テストデータ付きセットアップ（推奨）

**ファイル**: `test-booking-time-schedules.sql`

このファイルを実行すると：
- テーブルが作成されます
- 2025年10月のサンプルデータが追加されます
- 月〜金: 午前10:00-13:00、午後15:00-19:00
- 土: 午前9:00-12:30

#### オプション2: テーブルのみ作成

**ファイル**: `manual-migration.sql`

このファイルはテーブルとRPC関数を作成しますが、サンプルデータは含まれません。

### ステップ4: 実行確認

SQLを実行後、以下のクエリで確認：

```sql
SELECT COUNT(*) FROM public.booking_time_schedules;
```

結果が0以上であればOKです。

---

## 📋 機能の使い方

### 1. 予約受付時間を追加

http://localhost:8080/admin/schedule の **「予約受付時間設定」** タブで：

1. **曜日を選択**
2. **バーをドラッグ**して時間を設定
3. **「追加する」** ボタンをクリック

### 2. 休憩時間を設定（午前・午後に分ける）

例：月曜日に昼休憩（13:00-15:00）を設定する場合：

1. **午前の時間帯**: 10:00-13:00 を追加
2. **「午後の時間帯を追加」** ボタンをクリック
3. 自動的に15:00-19:00が追加されます
4. 各バーを**ドラッグして調整**可能

### 3. 複数時間帯の表示

- 各曜日カードの上部に**緑色のバー**で表示
- バー間の空白 = 休憩時間
- 最大3つまで時間帯を追加可能

---

## 🎯 動作確認

### テスト1: データ追加

1. 月曜日の「時間帯を追加」ボタンをクリック
2. 成功メッセージ「予約受付時間設定完了」が表示
3. 緑色のバーが表示される

### テスト2: バー編集

1. 既存設定の「編集」ボタンをクリック
2. バーの両端をドラッグ
3. 「保存」をクリック
4. バーが更新される

### テスト3: 複数時間帯

1. 既に1つ時間帯がある曜日で「午後の時間帯を追加」をクリック
2. 2つの緑バーが表示される
3. バー間の空白が休憩時間

---

## 🐛 トラブルシューティング

### エラー: "予約受付時間設定エラー"

**原因**: データベーステーブルが存在しない

**解決**: `test-booking-time-schedules.sql` をSupabaseで実行

### エラー: "function public.insert_booking_time_schedule does not exist"

**原因**: RPC関数が古いバージョン

**解決**: `booking-time-schedule-functions.sql` をSupabaseで実行

### バーが表示されない

**原因**: データが存在しない

**解決**: 
1. 「新しい予約受付時間を追加」フォームから追加
2. または `test-booking-time-schedules.sql` でサンプルデータを追加

---

## 📞 サポート

問題が解決しない場合は、ブラウザのコンソール（F12キー）でエラーメッセージを確認してください。




